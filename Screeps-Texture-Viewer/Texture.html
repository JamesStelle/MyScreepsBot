<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screeps-Texture-Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .instructions {
            background-color: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .instructions h3 {
            color: #f57c00;
            margin-top: 0;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin: 8px 0;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: monospace;
            font-size: 14px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .result {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .error {
            background-color: #ffebee;
            border: 1px solid #f44336;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            color: #c62828;
        }
        .preview {
            text-align: center;
            margin: 20px 0;
        }
        .preview img {
            max-width: 400px;
            max-height: 400px;
            border: 2px solid #ddd;
            border-radius: 4px;
        }
        .download-link {
            display: inline-block;
            background-color: #2196F3;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 4px;
            margin: 10px 5px;
        }
        .download-link:hover {
            background-color: #1976D2;
        }
        .url-display {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            cursor: pointer;
        }
        .url-display:hover {
            background-color: #e8e8e8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Screeps-Texture-Viewer</h1>
        <p>è·å–Steamå¸‚åœºä¸ŠScreeps textureçš„800x800é«˜åˆ†è¾¨ç‡å›¾ç‰‡</p>
        
        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨æ­¥éª¤</h3>
            <p><strong>æ–¹æ³•1: å³é”®è·å–å›¾ç‰‡ (ç®€å•)</strong></p>
            <ol>
                <li>æ‰¾åˆ°textureçš„ç¼©ç•¥å›¾</li>
                <li><strong>å³é”®ç‚¹å‡»ç¼©ç•¥å›¾</strong> â†’ é€‰æ‹© <strong>"å¤åˆ¶å›¾ç‰‡åœ°å€"</strong></li>
                <li>ç²˜è´´åˆ°ä¸‹é¢çš„è¾“å…¥æ¡†ä¸­</li>
            </ol>
            <p><strong>æ–¹æ³•2: ä»å¼€å‘è€…å·¥å…·è·å– (é«˜è´¨é‡)</strong></p>
            <ol>
                <li>æ‰“å¼€Steamå¸‚åœºé¡µé¢</li>
                <li>æŒ‰ <strong>F12</strong> æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
                <li>åœ¨ <strong>Elements</strong> æ ‡ç­¾ä¸­æœç´¢ <code>image_src</code></li>
                <li>æ‰¾åˆ°ç±»ä¼¼è¿™æ ·çš„æ ‡ç­¾ï¼š<code>&lt;link rel="image_src" href="..."&gt;</code></li>
                <li>å¤åˆ¶ <code>href</code> ä¸­çš„URLå¹¶ç²˜è´´åˆ°ä¸‹é¢</li>
            </ol>
        </div>

        <div class="input-group">
            <label for="imageUrl">å›¾ç‰‡URL (å³é”®è·å–æˆ–ä»å¼€å‘è€…å·¥å…·è·å–):</label>
            <input type="text" id="imageUrl" placeholder="ç²˜è´´å›¾ç‰‡URL..." 
                   value="https://community.steamstatic.com/economy/image/rtOnLXYUD-u65eusOk-nO4hCpUCJo2NbTFgyVoRu1dTMUtrgwQcK00wcDPtguX6_6cpCjkj5KCLzRKX8j0q3Yji5umhEwn0Cjhgkm40MUW3kqczfGShQbGJ-wsYuY_ybvHXycjiV/360fx360f">
        </div>

        <button onclick="convertToHighRes()" id="convertBtn">ğŸ”„ è½¬æ¢ä¸º800x800é«˜åˆ†è¾¨ç‡</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>

        <div id="results"></div>
    </div>

    <script>
        function convertToHighRes() {
            const imageUrl = document.getElementById('imageUrl').value.trim();
            const resultsDiv = document.getElementById('results');
            const convertBtn = document.getElementById('convertBtn');

            if (!imageUrl) {
                showError('è¯·è¾“å…¥å›¾ç‰‡URL');
                return;
            }

            // éªŒè¯URLæ ¼å¼
            if (!imageUrl.includes('community.steamstatic.com/economy/image/') && 
                !imageUrl.includes('community.akamai.steamstatic.com/economy/image/')) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„Steamå›¾ç‰‡URL<br>URLåº”è¯¥åŒ…å« "community.steamstatic.com/economy/image/"');
                return;
            }

            convertBtn.disabled = true;
            convertBtn.textContent = 'â³ è½¬æ¢ä¸­...';

            try {
                // æå–åŸºç¡€URLï¼Œæ”¯æŒå¤šç§å°ºå¯¸æ ¼å¼
                let baseUrl = imageUrl;
                
                // ç§»é™¤å„ç§å¯èƒ½çš„å°ºå¯¸å‚æ•°æ ¼å¼
                baseUrl = baseUrl.replace(/\/\d+x\d+(\?.*)?$/, '');           // 330x192 æ ¼å¼
                baseUrl = baseUrl.replace(/\/\d+fx\d+f(\?.*)?$/, '');         // 360fx360f æ ¼å¼
                baseUrl = baseUrl.replace(/\/\d+x\d+f(\?.*)?$/, '');          // 360x360f æ ¼å¼
                baseUrl = baseUrl.replace(/\/\d+fx\d+(\?.*)?$/, '');          // 360fx360 æ ¼å¼
                
                // ç§»é™¤æŸ¥è¯¢å‚æ•°
                baseUrl = baseUrl.split('?')[0];
                
                // ç”Ÿæˆ800x800ç‰ˆæœ¬
                const highResUrl = baseUrl + '/800x800';
                
                // æå–texture IDç”¨ä½œæ–‡ä»¶å
                const textureId = extractTextureId(imageUrl);
                
                // æ£€æµ‹åŸå§‹å°ºå¯¸ç”¨äºæ˜¾ç¤º
                const originalSize = detectOriginalSize(imageUrl);
                
                showSuccess(highResUrl, textureId, originalSize);
                
            } catch (error) {
                showError('URLè½¬æ¢å¤±è´¥: ' + error.message);
            } finally {
                convertBtn.disabled = false;
                convertBtn.textContent = 'ğŸ”„ è½¬æ¢ä¸º800x800é«˜åˆ†è¾¨ç‡';
            }
        }

        function detectOriginalSize(imageUrl) {
            // æ£€æµ‹åŸå§‹å›¾ç‰‡å°ºå¯¸
            const sizePatterns = [
                /\/(\d+x\d+)(\?.*)?$/,      // 330x192
                /\/(\d+fx\d+f)(\?.*)?$/,    // 360fx360f
                /\/(\d+x\d+f)(\?.*)?$/,     // 360x360f
                /\/(\d+fx\d+)(\?.*)?$/      // 360fx360
            ];
            
            for (const pattern of sizePatterns) {
                const match = imageUrl.match(pattern);
                if (match) {
                    return match[1];
                }
            }
            return 'æœªçŸ¥å°ºå¯¸';
        }

        function extractTextureId(imageUrl) {
            // å°è¯•ä»URLä¸­æå–æœ‰ç”¨ä¿¡æ¯ä½œä¸ºæ–‡ä»¶å
            const match = imageUrl.match(/\/([^\/]+)\/\d+x\d+/);
            if (match) {
                return match[1].substring(0, 20); // æˆªå–å‰20ä¸ªå­—ç¬¦
            }
            return 'screeps_texture';
        }

        function showSuccess(highResUrl, textureId, originalSize) {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="result">
                    <h3>âœ… è½¬æ¢æˆåŠŸï¼</h3>
                    <p><strong>åŸå§‹å°ºå¯¸:</strong> ${originalSize} â†’ <strong>è½¬æ¢å:</strong> 800x800</p>
                    
                    <div class="preview">
                        <img src="${highResUrl}" alt="800x800 Texture Preview" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div style="display:none; color: #666; padding: 20px; border: 2px dashed #ddd; border-radius: 4px;">
                            ğŸ“· å›¾ç‰‡é¢„è§ˆåŠ è½½å¤±è´¥<br>
                            <small>å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–å›¾ç‰‡ä¸å­˜åœ¨ï¼Œä½†URLè½¬æ¢æ˜¯æ­£ç¡®çš„</small>
                        </div>
                        <p><strong>800x800 é«˜åˆ†è¾¨ç‡é¢„è§ˆ</strong></p>
                    </div>

                    <div style="text-align: center;">
                        <a href="${highResUrl}" target="_blank" class="download-link" download="${textureId}_800x800.png">
                            ğŸ“¥ ä¸‹è½½å›¾ç‰‡
                        </a>
                        <button onclick="copyToClipboard('${highResUrl}')" style="background-color: #ff9800; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
                            ğŸ“‹ å¤åˆ¶URL
                        </button>
                    </div>

                    <div style="margin-top: 15px;">
                        <strong>800x800é«˜åˆ†è¾¨ç‡URL:</strong>
                        <div class="url-display" onclick="selectText(this)" title="ç‚¹å‡»é€‰ä¸­å¤åˆ¶">${highResUrl}</div>
                        <small style="color: #666;">ğŸ’¡ ç‚¹å‡»URLå¯ä»¥é€‰ä¸­å¤åˆ¶</small>
                    </div>
                </div>
            `;
        }

        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="error">
                    <h3>âŒ é”™è¯¯</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('imageUrl').value = '';
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(function() {
                    alert('âœ… URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }, function(err) {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert('âœ… URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                alert('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶URL');
            }
            document.body.removeChild(textArea);
        }

        function selectText(element) {
            const range = document.createRange();
            range.selectNodeContents(element);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }

        // å…è®¸å›è½¦é”®è§¦å‘è½¬æ¢
        document.getElementById('imageUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                convertToHighRes();
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        window.addEventListener('load', function() {
            console.log('ğŸ¨ Screeps-Texture-Viewer å·²å‡†å¤‡å°±ç»ªï¼');
            console.log('ğŸ’¡ æç¤º: æŒ‰ç…§é¡µé¢æŒ‡å¯¼è·å–Steamå›¾ç‰‡URLï¼Œç„¶åä¸€é”®è½¬æ¢ä¸º800x800é«˜åˆ†è¾¨ç‡');
        });
    </script>
</body>
</html>